From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Siroshun09 <siro.shun8@gmail.com>
Date: Wed, 17 Dec 2025 10:15:25 +0900
Subject: [PATCH] Add custom and resource worlds


diff --git a/src/main/java/io/papermc/paper/world/PaperWorldLoader.java b/src/main/java/io/papermc/paper/world/PaperWorldLoader.java
index 51a01f86fee58052cfa10febc2b3ddf8f6dd2ad7..5c7be39cf78a4e9ba8df40dcb4b57367a078aad4 100644
--- a/src/main/java/io/papermc/paper/world/PaperWorldLoader.java
+++ b/src/main/java/io/papermc/paper/world/PaperWorldLoader.java
@@ -105,11 +105,30 @@ public record PaperWorldLoader(MinecraftServer server, String levelId) {
             }
         }
     }
+    // okocraft start - Add custom worlds
+    private java.util.List<WorldLoadingInfo> loadWorldInfoList() {
+        java.util.List<WorldLoadingInfo> worlds = new java.util.ArrayList<>();
+        for (final LevelStem stem : this.server.registryAccess().lookupOrThrow(Registries.LEVEL_STEM)) {
+            worlds.add(this.getWorldInfo(this.levelId, stem));
+        }
+
+        try {
+            worlds.addAll(net.okocraft.paper.CustomWorlds.readCustomWorldFile(java.nio.file.Path.of("custom-worlds.txt")));
+            worlds.addAll(net.okocraft.paper.CustomWorlds.readResourceNumberFile(java.nio.file.Path.of("resource-world-number.txt")));
+        } catch (IOException e) {
+            LOGGER.warn("Cannot load custom worlds: {}", e.getMessage());
+        }
+
+        return worlds;
+    }
+    // okocraft end - Add custom worlds
 
     // Loosely modeled on code in net.minecraft.server.Main
     public void loadInitialWorlds() {
-        for (final LevelStem stem : this.server.registryAccess().lookupOrThrow(Registries.LEVEL_STEM)) {
-            final WorldLoadingInfo info = this.getWorldInfo(this.levelId, stem);
+        // okocraft start - Add custom worlds
+        for (final WorldLoadingInfo info : this.loadWorldInfoList()) {
+            LevelStem stem = this.server.registryAccess().lookupOrThrow(Registries.LEVEL_STEM).getValue(info.stemKey());
+        // okocraft end - Add custom worlds
             this.migrateWorldFolder(info);
             if (!info.enabled()) {
                 continue;
